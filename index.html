<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Sequential Markers â€” Direct Load (Absolute Paths)</title>

  <!-- A-Frame + AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    .arjs-loader {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0; left: 0;
      background-color: rgba(0,0,0,0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .arjs-loader div { text-align:center; font-size:1.25em; color:white; }
  </style>
</head>

<body style="margin:0; overflow:hidden;">
  <div class="arjs-loader"><div>Loading, please wait...</div></div>

  <a-scene
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true;"
  >
    <!-- Marker A: contains its model directly (absolute path) -->
    <a-nft id="markerA"
      type="nft"
      url="https://lucian-lu.github.io/trm-lab-2/nft/subway_ticket/subway_ticket"
      smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"
    >
      <a-entity
        gltf-model="https://lucian-lu.github.io/trm-lab-2/models/test.glb"
        scale="200 200 200"
        position="0 0 0"
        rotation="0 0 0"
      ></a-entity>
    </a-nft>

    <!-- Marker B: initially empty, will receive content when A is found -->
    <a-nft id="markerB"
      type="nft"
      url="https://lucian-lu.github.io/trm-lab-2/nft/ramen_menu/ramen_menu"
      smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"
    >
      <!-- content added dynamically -->
    </a-nft>

    <!-- Marker C: initially empty, will receive content when B is found -->
    <a-nft id="markerC"
      type="nft"
      url="https://lucian-lu.github.io/trm-lab-2/nft/ramen_bar_entrance/ramen_bar_entrance"
      smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"
    >
      <!-- content added dynamically -->
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // flags to prevent duplicate insertion
    let addedToB = false;
    let addedToC = false;

    // absolute model URLs
    const modelA = "https://lucian-lu.github.io/trm-lab-2/models/test.glb";
    const modelB = "https://lucian-lu.github.io/trm-lab-2/models/test.glb";
    const modelC = "https://lucian-lu.github.io/trm-lab-2/models/test.glb";

    const markerA = document.getElementById('markerA');
    const markerB = document.getElementById('markerB');
    const markerC = document.getElementById('markerC');

    // when A is found: ensure B has its content (like example)
    markerA.addEventListener('markerFound', () => {
      if (addedToB) return;
      addedToB = true;

      markerB.innerHTML += `
        <a-entity
          gltf-model="${modelB}"
          scale="200 200 200"
          position="0 0 0"
          rotation="0 0 0"
        ></a-entity>
        <a-text
          value="Second marker active"
          color="magenta"
          width="6"
          rotation="-90 0 0"
          position="0 0 0.2"
        ></a-text>
      `;
    });

    // when B is found: ensure C has its content
    markerB.addEventListener('markerFound', () => {
      if (!addedToB) return; // enforce sequence (optional)
      if (addedToC) return;
      addedToC = true;

      markerC.innerHTML += `
        <a-entity
          gltf-model="${modelC}"
          scale="200 200 200"
          position="0 0 0"
          rotation="0 0 0"
        ></a-entity>
        <a-text
          value="Third marker active"
          color="cyan"
          width="6"
          rotation="-90 0 0"
          position="0 0 0.2"
        ></a-text>
      `;
    });

    // hide loader after initial load attempt or a fixed time
    window.addEventListener('load', () => {
      setTimeout(()=> {
        const loader = document.querySelector('.arjs-loader');
        if (loader) loader.style.display = 'none';
      }, 8000);
    });
  </script>
</body>
</html>
